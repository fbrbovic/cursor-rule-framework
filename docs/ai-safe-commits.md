# 🤖 AI-Safe Commit Guidelines

> **Preventing Accidental Major Releases with AI-Generated Commits**

## 🎯 Overview

This guide ensures safe collaboration between human developers and AI assistants (like Cursor AI) to prevent accidental major version releases while maintaining automated release workflows.

## 🚨 Safety Mechanisms

Our release system includes multiple AI-safety features:

### 🔒 **No Automatic Major Releases**
- **Automatic triggers**: Only `patch` and `minor` releases
- **Major releases**: Must be triggered manually via GitHub Actions UI
- **Safety net**: Code will error if major release attempts automatic trigger

### 🔍 **Smart Pattern Detection**
- **Conventional Commits**: Respects `feat:`, `fix:`, `perf:` when used
- **Smart File Analysis**: Detects changes when commit messages aren't conventional
- **Keyword Analysis**: Scans commit content for feature/fix keywords
- **Danger Detection**: Warns about potential breaking change language
- **Safe Fallback**: Always defaults to patch/minor releases

### ✅ **Manual Approval for Major Changes**
- Major releases require manual workflow dispatch
- GitHub environment protection for production releases
- Extra validation steps and warnings

## 📝 AI-Safe Commit Patterns

### ✅ **Safe Patterns (Auto-Release)**

```bash
# CONVENTIONAL COMMITS (preferred)
feat: add new architecture validation rules    # → Minor release
fix: resolve cursor rule validation issue      # → Patch release
docs: update installation instructions         # → Patch release

# SMART DETECTION - Works even without conventional format!
Add new validation system                      # → Minor (keywords: "add", "new")
Fix parsing issue in rules                     # → Patch (keywords: "fix")
Update documentation with examples             # → Patch (file changes: *.md)
Create new cursor rule template                # → Minor (new files + keywords)
Improve workflow automation                    # → Patch (workflow files)
```

### 🤖 **Smart Detection Logic**

When Cursor AI doesn't use conventional commits, the system analyzes:

**File Changes:**
- **New files added** → Minor release (suggests new features)
- **Documentation updates** → Patch release  
- **New cursor rules** → Minor release
- **Modified cursor rules** → Patch release
- **Script/tool changes** → Minor release
- **Workflow updates** → Patch release
- **Dependencies updated** → Patch release

**Commit Message Keywords:**
- **Feature words**: "add", "create", "implement", "new", "enhance" → Minor
- **Fix words**: "fix", "resolve", "correct", "repair", "bug" → Patch
- **Danger words**: "breaking", "remove", "delete", "major" → ⚠️ Warning

**Smart Examples:**
```bash
"Add new validation feature"           # → Minor (keyword: "add", "new")
"Update documentation"                 # → Patch (files: *.md)
"Create rule template"                 # → Minor (new file + keywords)
"Fix issue with parsing"               # → Patch (keyword: "fix")
"Improve workflow scripts"             # → Minor (script changes)
```

### ⚠️ **Dangerous Patterns (Manual Only)**

```bash
# These patterns should NEVER be automatically generated by AI:

# MAJOR release triggers (BLOCKED in automatic releases)
feat!: restructure rule organization system
BREAKING CHANGE: rule format has changed
feat: complete API redesign (breaking change)

# Patterns that trigger warnings but safe fallback:
feat: add breaking changes to validation  # → Warns but creates minor release
fix: resolve major compatibility issue     # → Warns but creates patch release
```

## 🛡️ Cursor AI Configuration

### **Recommended Cursor Settings**

Configure Cursor AI to avoid dangerous patterns:

```json
// .cursor/settings.json
{
  "ai.commitMessage.avoidPatterns": [
    "BREAKING CHANGE",
    "breaking change",
    "feat!:",
    "!:",
    "major version",
    "major release",
    "breaking changes"
  ],
  "ai.commitMessage.preferredPatterns": [
    "feat:",
    "fix:",
    "docs:",
    "style:",
    "refactor:",
    "test:",
    "chore:"
  ]
}
```

### **Safe AI Prompts**

When asking Cursor AI for commit messages:

✅ **Good prompts:**
```
"Generate a conventional commit message for this feature addition"
"Create a commit message for this bug fix"
"Write a commit message for documentation updates"
```

❌ **Avoid these prompts:**
```
"Generate a commit for this breaking change"
"Create a major version commit message"
"Write a commit that indicates API changes"
```

## 🔧 Manual Major Release Process

When you actually need a major release:

### **Step 1: Prepare**
```bash
# Ensure you're ready for breaking changes
git checkout main
git pull origin main

# Validate everything works
npm run validate:rules
npm run validate:docs
npm test
```

### **Step 2: Manual Trigger**
1. Go to **GitHub Actions** → **Release** workflow
2. Click **"Run workflow"**
3. Select **"major"** from release type dropdown
4. Click **"Run workflow"**

### **Step 3: Verify**
- Check release notes mention breaking changes
- Verify migration guides are included
- Test release assets work correctly

## 📊 Monitoring AI Safety

### **Workflow Logs to Watch**

The workflow will show these safety messages:

```bash
✅ Safe automatic release:
"📋 Version: 1.2.3 → 1.3.0 (minor)"

⚠️ AI generated dangerous patterns:
"⚠️ WARNING: Detected potential breaking change keywords in commit message"
"⚠️ Auto-release will be PATCH/MINOR only. Use manual release for major versions."

🚨 Safety system activated:
"🚨 ERROR: Major release attempted via automatic trigger"
"🚨 This is not allowed for AI safety reasons"
```

### **GitHub Actions Safety Features**

- **Environment Protection**: Major releases require approval
- **Pattern Detection**: Warns about dangerous commit messages
- **Fail-Safe**: Exits with error if major release detected in auto mode
- **Verbose Logging**: Clear visibility into release decisions

## 🎯 Best Practices

### **For Daily Development**

1. **Use conventional commits** for automatic releases:
   ```bash
   feat: add new rule validation
   fix: resolve parsing issue
   docs: update getting started guide
   ```

2. **Review AI-generated commits** before pushing:
   ```bash
   git log -1 --oneline  # Check the commit message
   git push origin main  # Only push if safe
   ```

3. **Let automation handle patch/minor releases**:
   - Push commits with confidence
   - Automatic releases every 2-4 weeks
   - No manual intervention needed

### **For Breaking Changes**

1. **Plan major releases carefully**:
   - Create RFC/issue for breaking changes
   - Communicate with users in advance
   - Prepare migration guides

2. **Use manual release process**:
   - Never rely on automatic triggers
   - Always use GitHub Actions UI
   - Include detailed release notes

3. **Test thoroughly**:
   - Validate all breaking changes
   - Test migration paths
   - Verify backward compatibility claims

## 🔍 Troubleshooting

### **AI Generated Dangerous Commits**

If Cursor AI accidentally generates problematic patterns:

```bash
# Option 1: Amend the commit message
git commit --amend -m "feat: add new validation system"

# Option 2: Reset and recommit  
git reset HEAD~1
git add .
git commit -m "feat: add new validation system"

# Then push safely
git push origin main
```

### **False Positive Warnings**

If the system warns about safe commits:

1. **Check the commit message** for unintended keywords
2. **Continue with confidence** - it will create a safe release
3. **Adjust the pattern** if false positives are common

### **Blocked Major Release**

If you get a major release error:

1. **This is working as intended** - safety system activated
2. **Use manual process** via GitHub Actions UI
3. **Review why** the commit triggered major detection

## 📈 Configuration Options

### **Adjusting Safety Levels**

You can customize the safety patterns in `.github/workflows/release.yml`:

```bash
# Current detection pattern:
"(BREAKING|breaking|major|MAJOR|!:|breaking change)"

# To make it more/less strict:
# More strict: "(BREAKING|breaking|major|MAJOR|!:|breaking change|change|update)"
# Less strict: "(BREAKING CHANGE|feat!)"
```

### **Emergency Override**

In emergencies, you can temporarily disable safety:

1. **Edit the workflow file** to allow automatic major releases
2. **Make the emergency release**
3. **Immediately restore safety** mechanisms

## 🔗 Related Documentation

- **[Release Management Guide](release-management.md)** - Complete release system
- **[Contributing Guide](../CONTRIBUTING.md)** - Development workflow
- **[Conventional Commits](https://www.conventionalcommits.org/)** - Commit message format

---

**🤖 Safe AI Collaboration:** This system lets you work confidently with Cursor AI while preventing accidental breaking changes to your users! 